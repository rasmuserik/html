(function(){var t,e,i,o,n,s,r,h,l,u,a,d,c,f,m,p,g,y,v,w=[].slice;f=function(t){return setTimeout(t,0)},null==Object.keys&&(Object.keys=function(t){var e,i,o;o=[];for(e in t)i=t[e],o.push(e);return o}),i=XMLHttpRequest,d=!1,"boolean"!=typeof(new i).withCredentials&&(d=!0,i=XDomainRequest),o=function(t,e,o){var n;return n=new i,n.onerror=function(t){return"function"==typeof o?o(t||!0):void 0},n.onload=function(){return"function"==typeof o?o(null,n.responseText):void 0},n.open(e?"POST":"GET",t,!!o),n.send(e),o?void 0:n.responseText},u=function(t,e){var i,o;for(i in e)o=e[i],t[i]=o;return t},r=function(t){var e,i,o,n,s,h;if("object"==typeof t){if(t.constructor===Array)for(o=[],s=0,h=t.length;h>s;s++)e=t[s],o.push(r(e));else{o={};for(i in t)n=t[i],o[i]=r(n)}return o}return t},l=function(t,e,i){return t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)},c=void 0,p=void 0,function(){var t,e,i,n,s,r;return e=Math.random(),n="/api/log",t=[],i=!1,s=200,r=400,p=function(){var s,h;if(!i){try{h=JSON.stringify(t)}catch(l){s=l,h="Error stringifying log"}return i=t,t=[],o(n,h,function(o){return setTimeout(function(){return i=!1},r),o?(c("logsync error",o),t=i.concat(t)):(t.push([+new Date,"log sync'ed",e,t.length]),d&&t.length>1?p():void 0)})}},c=function(){var e;return e=1<=arguments.length?w.call(arguments,0):[],t.push([+new Date].concat(w.call(e))),(t.length>s||d)&&f(p),e},f(function(){return l(window,"error",function(t){return c("window.onerror ",String(t))}),l(window,"beforeunload",function(){var e;c("window.beforeunload");try{o(n,JSON.stringify(t))}catch(i){e=i}return void 0})}),c("starting",e,window.performance)}(),h={frames:{current:0,normal:{width:void 0,height:void 0,urls:[]},zoom:{width:void 0,height:void 0,urls:[]}},spinOnLoadFPS:30,fullscreen:!1,zoom:{lensSize:200,enabled:!1,x:void 0,y:void 0},showLogo:!0,loading:!0,domElem:{width:void 0,height:void 0,domId:void 0}},e=function(t,e){var i,o,n,s,r,h,l,a,f;if(this.model=t,o=document.getElementById(e),!o)throw c("couldn't find dom element for view",e);for(this.defaultWidth=t.width||o.offsetWidth,this.defaultHeight=t.height||o.offsetHeight,this.style={root:{textAlign:"left",webkitTapHighlightColor:"rgba(0,0,0,0)",webkitUserSelect:"none",display:"inline-block",cursor:"url(res/cursor_rotate.cur),move"},image:{width:"100%",height:"100%"},zoomLens:{display:"block",position:"absolute",overflow:"hidden",width:this.model.zoom.lensSize,height:this.model.zoom.lensSize,border:"0px solid black",cursor:"default",backgroundColor:d?void 0:"rgba(100,100,100,0.8)",borderRadius:this.model.zoom.lensSize/2,boxShadow:"0px 0px 40px 0px rgba(255,255,255,.7) inset, 4px 4px 9px 0px rgba(0,0,0,0.5)",backgroundRepeat:"no-repeat"},logo:{position:"absolute",opacity:"0.7",textShadow:"0px 0px 5px white",color:"#333",transition:"opacity 0.5s"},btnFull:{position:"absolute"},btnZoom:{position:"absolute"},spinner:{position:"absolute",top:"49%",left:"49%"}},i={position:"absolute",color:"#333",opacity:"0.7",textShadow:"0px 0px 5px white",backgroundColor:d?void 0:"rgba(255,255,255,0)",fontSize:.08*this.defaultHeight,padding:.02*this.defaultHeight},u(this.style.btnFull,i),u(this.style.btnZoom,i),this.elems={},this.elems.root=document.createElement("div"),this.elems.root.innerHTML='<img><div class="onetwo360-zoom-lens"></div><i class="icon-OneTwo360Logo"></i><i class="fa fa-fullscreen onetwo360-fullscreen-button"></i><i class="fa fa-search onetwo360-fullscreen-button"></i><img src="spinner.gif">',o.appendChild(this.elems.root),n=Object.keys(this.style),s=l=1,a=n.length-1;a>=1?a>=l:l>=a;s=a>=1?++l:--l)this.elems[n[s]]=this.elems.root.childNodes[s-1];this.width=void 0,this.height=void 0,this.showLogo=void 0,this.imgSrc=void 0,this.elemStyle={},this.styleCache={},f=this.elems;for(r in f)h=f[r],this.elemStyle[r]=this.elems[r].style,this.styleCache[r]={};return this.update(),this},e.prototype.update=function(){var t;if(!this.updateReq)return this.updateReq=!0,t=this,f(function(){return t._update(),t.updateReq=!1})},e.prototype._update=function(){return this._fullscreen(),this._root(),this._overlays(),this._zoomLens(),this._image(),this._applyStyle(),c("View#_update'd",this.top,this.left,this.width,this.height)},e.prototype._fullscreen=function(){var t,e,i,o,n;return this.model.fullscreen?(u(this.style.root,{position:"absolute",zIndex:"10000",top:window.scrollY,left:window.scrollX,width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}),o=this.model.frames.normal.width,e=this.model.frames.normal.height,i=o/e,n=this.style.root.width/this.style.root.height,u(this.style.image,{position:"absolute",width:this.style.root.width*Math.min(1,i/n),height:this.style.root.height*Math.min(1,n/i)}),u(this.style.image,{left:(this.style.root.width-this.style.image.width)/2,top:(this.style.root.height-this.style.image.height)/2})):(u(this.style.root,{position:"relative",zIndex:"0",top:0,left:0,width:this.defaultWidth,height:this.defaultHeight}),u(this.style.image,{position:"relative",top:0,left:0,width:this.defaultWidth,height:this.defaultHeight}),t=this.elems.root.getBoundingClientRect()),this.top=this.style.image.top,this.left=this.style.image.left,this.width=this.style.image.width,this.height=this.style.image.height},e.prototype._root=function(){return void 0},e.prototype._overlays=function(){var t;return this.style.spinner.display=this.model.loading?"block":"none",u(this.style.logo,{top:.35*this.height,left:.5*this.width-.3*this.height,fontSize:.2*this.height,opacity:this.model.showLogo?"1":"0"}),t={top:this.top+this.height-.1*this.width,fontSize:.06*this.width,padding:.02*this.height},u(this.style.btnFull,t),this.style.btnFull.left=this.left+.9*this.width,u(this.style.btnZoom,t),this.style.btnZoom.left=this.left+.02*this.width},e.prototype._zoomLens=function(){var t,e,i,o,n,s,r,h,l,a,d=this;return this.model.zoom.enabled?(i=this.model.frames.current,l=this.model.frames.zoom.urls[i],a=this.model.frames.zoom.width,o=this.model.frames.zoom.height,r=this.model.zoom.lensSize,n=new Image,n.src=l,n.complete||(n.onload=function(){return d.update()},l=this.model.frames.normal.urls[i]),s=Math.max(0,Math.min(this.width,this.model.zoom.x-this.left)),h=Math.max(0,Math.min(this.height,this.model.zoom.y-this.top)),t=-s/this.width*(a+r)+r/2,e=-h/this.height*(o+r)+r/2,u(this.style.zoomLens,{position:"absolute",display:"block",left:s-r/2+this.left,top:h-r/2+this.top,backgroundImage:"url("+l+")",backgroundSize:""+(a+r)+"px "+(o+r)+"px",backgroundPosition:""+t+"px "+e+"px"})):u(this.style.zoomLens,{display:"none"})},e.prototype._image=function(){var t;return t=this.model.frames.normal.urls[this.model.frames.current],void 0!==t&&t!==this.imgSrc?(this.elems.image.src=t,this.imgSrc=t):void 0},e.prototype._applyStyle=function(){var t,e,i,o,n,s;n=this.style,s=[];for(e in n)t=n[e],s.push(function(){var n;n=[];for(i in t)o=t[i],this.styleCache[e][i]!==o?("number"==typeof o&&(o+="px"),this.elemStyle[e][i]=o,n.push(this.styleCache[e][i]=o)):n.push(void 0);return n}.call(this));return s},n=function(t,e){var i,o,n,s,r,h;for(t.loaded=[],i=0,c("caching frameset",t.urls),h=[],o=s=0,r=t.urls.length-1;r>=0?r>=s:s>=r;o=r>=0?++s:--s)n=new Image,n.onload=function(o){return function(){return t.loaded[o]=+new Date,++i===t.urls.length?(c("done caching frameset",t.urls),"function"==typeof e?e():void 0):void 0}}(o),h.push(n.src=t.urls[o]);return h},a=function(t,e,i){var o,s,r,h,l;return l=+new Date,h=void 0,r=0,o=!1,t.frames.current=0,s=function(){var o,n,u,a,d;for(o=0,a=l;t.frames.normal.loaded[o];)a=Math.max(t.frames.normal.loaded[o],a),++o;if(o>t.frames.current+1&&(d=+new Date,null==h&&(h=d),u=(a-l)/o,n=Math.max(u,1e3/t.spinOnLoadFPS),d>h+n)){for(;d>h+n;)r=t.frames.current=Math.min(o-1,t.frames.current+1),h+=n;h=d,c("incremental load animation",r),e.update()}return t.frames.current===r&&t.frames.current<t.frames.normal.urls.length-1?f(s):(c("finished incremental load animation"),"function"==typeof i?i():void 0)},t.spinOnLoadFPS?(n(t.frames.normal,function(){return t.loading=!1,e.update()}),c("starting incremental load animation"),s()):n(t.frames.normal(function(){return t.loading=!1,e.update(),"function"==typeof i?i():void 0}))},g=+new Date,v=500,y=100,m=function(t,e){return l(t,"mousedown",function(t){return"function"==typeof t.preventDefault&&t.preventDefault(),e(t)}),l(t,"touchstart",function(t){return"function"==typeof t.preventDefault&&t.preventDefault(),e(t)})},t=function(t){var e,i;return i=this,this.elem=t,e=function(t){return function(e){var o;return i.touching?("function"==typeof e.preventDefault&&e.preventDefault(),t.call(i,(null!=(o=e.touches)?o[0]:void 0)||e),!0):void 0}},l(document,"mousemove",e(this._move)),l(document,"touchmove",e(this._move)),l(document,"mouseup",e(this._end)),l(document,"touchend",e(this._end)),l(t,"mousedown",function(t){return"function"==typeof t.preventDefault&&t.preventDefault(),i.start(t)}),l(t,"touchstart",function(t){return"function"==typeof t.preventDefault&&t.preventDefault(),i.start(t.touches[0])}),this._reset(),this},t.prototype._reset=function(){return this.touching=!1,this.holding=!1,this.startTime=+new Date,this.maxDist2=0},t.prototype._update=function(t){var e,i,o;return e=this.elem.getBoundingClientRect(),i=this.x,o=this.y,this.x=t.clientX-e.left,this.y=t.clientY-e.top,this.dx=this.x-this.x0||0,this.dy=this.y-this.y0||0,this.ddx=this.x-i||0,this.ddy=this.y-o||0,this.maxDist2=Math.max(this.maxDist2,this.dx*this.dx+this.dy*this.dy),this.time=+new Date-this.startTime},t.prototype.start=function(t){var e=this;if(!this.touching)return this._update(t),this._reset(),this.touching=!0,this.isMouse=!t.touches,this.isMouse||(t=t.touches[0]),this.x0=this.x,this.y0=this.y,this._update(t),"function"==typeof this.onstart&&this.onstart(),setTimeout(function(){return e._holdTimeout()},v),!0},t.prototype._holdTimeout=function(){return this.touching&&!this.holding&&this.maxDist2<y?(this.holding=!0,"function"==typeof this.onhold?this.onhold():void 0):void 0},t.prototype._move=function(t){return this._update(t),"function"==typeof this.onmove?this.onmove():void 0},t.prototype._end=function(t){return this.touching?(this._update(t),"function"==typeof this.onend&&this.onend(),this.maxDist2<y&&this.time<v&&"function"==typeof this.onclick&&this.onclick(),this._reset()):void 0},s=function(e,i){var o,n,s,r,h;return r=new t(i.elems.root),n=void 0,r.onstart=function(){return e.showLogo=!1,n=e.frames.current,c("touchstart",this.x,e.frames.current),i.update()},o=function(){return e.frames.current=(n+this.dx/10>>>0)%e.frames.normal.urls.length,c("touchmove",this.x,this.dx,e.frames.current),i.update()},r.onmove=o,h=function(){return e.zoom.x=this.x,e.zoom.y=this.y,i.update()},s=function(){var t=this;return f(function(){return r.start({clientX:t.x,clientY:t.y}),e.zoom.enabled=!0,h.call(t)}),r.onmove=h,r.onend=function(){return e.zoom.enabled=!1,i.update(),r.onmove=o,r.onend=void 0}},r.onclick=function(){return this.isMouse?s.call(r):void 0},r.onhold=s,m(i.elems.btnZoom,function(){return s.call(r)}),m(i.elems.btnFull,function(t){return t.preventDefault(),e.fullscreen=!e.fullscreen,f(function(){return r.touching=!1,i.update()})})},window.onetwo360=function(t){return"complete"!==document.readyState?setTimeout(function(){return window.onetwo360(t)},100):(c("onetwo360 called",t),o("//embed.onetwo360.com/"+t.product_id,void 0,function(i,o){var n,l,u,d,f,m;if(i)throw c("error loading embed data",t.product_id);for(o=JSON.parse(o),c("got and parsed data",t.product_id),l=r(h),l.frames.normal.width=o.width,l.frames.normal.height=o.height,l.frames.zoom.width=o.zoomWidth,l.frames.zoom.height=o.zoomHeight,l.width=t.request_width,l.height=t.request_height,m=o.files,d=0,f=m.length;f>d;d++)n=m[d],l.frames.normal.urls.push(o.baseUrl+n.normal),l.frames.zoom.urls.push(o.baseUrl+n.zoom);return t.dontSpinOnLoad&&(l.spinOnLoadFPS=0),u=new e(l,t.elem_id),a(l,u),s(l,u)}))}}).call(this);